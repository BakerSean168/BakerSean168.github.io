---
title: JS中的垃圾回收机制和内存泄漏
categories:
  - null
description: JS中的垃圾回收机制和内存泄漏
date: 2025-01-19 10:04:38
tags:
---

# JS 中的垃圾回收机制

## 概念

垃圾回收（Garbage Collection, GC）  
JavaScript 自动管理内存的核心机制，通过识别和释放不再使用的内存空间，防止内存泄漏并提升性能。  
可达性（Reachability）：从根对象（如全局变量、活动函数的局部变量等）出发，通过引用链无法访问的对象会被视为垃圾。

## 回收机制

JS 中有两种方式来实现垃圾回收

- 标记-清除（Mark-and-Sweep）  
  原理：  
   标记阶段：从根对象出发，递归遍历所有可达对象并标记为活动。  
   清除阶段：遍历堆内存，释放未被标记的对象。  
  优点：  
   能处理循环引用问题  
  缺点：  
   可能产生内存碎片，清除时需要暂停程序。
- 引用计数（Reference Counting）  
  原理：  
   每个对象维护引用计数器，引用数量为 0 时回收。  
  优点：  
   可即时回收内存。  
  缺点：  
   无法解决循环引用问题。

### 怎么减少垃圾回收

数组  
在清空一个数组时，最简单的方法就是给其赋值为[ ]，但是与此同时会创建一个新的空对象，可以将数组的长度设置为0，以此来达到清空数组的目的。  

对象  
对于不再使用的对象，就将其设置为null，尽快被回收。  

函数  
在循环中的函数表达式，如果可以复用，尽量放在函数的外面。  

# 内存泄漏

## 概念

内存泄露：由于错误或者疏忽程序没有释放已经不在使用的内存 无用的内存还在占用，得不到释放和归还，严重的时候无用的内存还在增加，导致整个系统的卡顿、奔溃  

内存溢出：当程序执行时需要的内存超过剩余内存的时候，会发生内存溢出  

## 内存泄漏发生的情况

以下四种情况会造成内存的泄漏：  
- 意外的全局变量： 由于使用未声明的变量，而意外的创建了一个全局变量，而使这个变量一直留在内存中无法被回收。
- 被遗忘的计时器或回调函数： 设置了 setInterval 定时器，而忘记取消它，那么这个变量会被一直留在内存中，而无法被回收。
- 脱离 DOM 的引用： 获取一个 DOM 元素的引用，而后面这个元素被删除，由于一直保留了对这个元素的引用，所以它也无法被回收。
- 闭包： 不合理的使用闭包，从而导致某些变量一直被留在内存当中。

# 参考

链接：https://juejin.cn/post/7120248211037487140

