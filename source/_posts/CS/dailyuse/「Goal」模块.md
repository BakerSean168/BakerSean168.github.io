---
title: 目标模块用DDD重构
categories:
  - null
description: 目标模块用DDD重构
date: 2025-07-06 19:10:01
tags:
---

# 业务理解

### 业务概览

**主要职责：**  
- 管理并量化用户的目标（关键结果）
- 为用户提供可视化的目标进度、时间范围
- 与任务模块的任务进行联动
- 与仓库模块进行联动
- 操作的全流程记录（找实习，面试了哪些，发放offer后准备事项。。。）

目标模块中有 目标节点（goalDir）、目标（goal）、关键结果（keyResult）、记录（record）、目标复盘（goalReview）  

目标节点作为文件夹，帮助用户对目标分类，如考研、学习、工作、生活等  
目标是关键数据，是用户目标的具体体现，大概包含目标的内容、期望实现时间、关键结果等，如准备考研英语  
关键结果用于将目标量化，如写十套真题卷、背完6000个考研单词、在某一次考试中取得90分以上  
记录是关键结果完成1次的记录，如「x月x日（日期） / 做了 22 年真题卷（可添加备忘信息） / 十套真题卷进度 +1（对应关键结果进度增加）」  
目标复盘是在某一个时间点时，通过对当前目标完成状态的分析，来帮助用户总结收获、调整状态，如任务中期复盘

根据以上分析：  
- 目标节点和目标应该作为聚合根，他们是唯一的  
- 关键结果和记录应该作为普通实体  

目标作为聚合根，应该来控制关键结果和记录的增删查改业务

**领域对象设计**：  
1. **聚合根**：  
   - `Goal`  
     - **唯一标识**：`GoalId`  
     - **关键属性**：  
       - `title`  
       - `startTime` `endTime`  
     - **行为**：  
       - 管理目标生命周期，如目标结束时复盘、进度许久不增加时提醒  
   - `GoalDir`


2. **实体**：  
   - `KeyResult`（关键结果）  
     - **标识**：`KeyResultId`  
     - **属性**：名称、开始值、目标值、当前值、计算方式、权重  
     - **行为**：进度许久不增加时提醒  
   - `Record`
     - **标识**：`RecordId`  
     - **属性**： 时间、备忘信息、关键结果增加的值    

### domain

1. goal

```ts
/**
 * 目标基础信息
 */
export interface IGoal {
  /** 目标 ID（UUID） */
  uuid: string;
  /** 标题 */
  title: string;
  /** 目标描述 */
  description?: string;
  /** 目标颜色 */
  color: string;
  /** 所在文件夹路径（Unix 格式，如 'goals/q3/product'） */
  dirId: string;
  /** 开始时间 */
  startTime: DateTime;
  /** 结束时间（需晚于开始时间） */
  endTime: DateTime;
  /** 备忘信息 */
  note?: string;
  /** 关键结果集 */
  keyResults: IKeyResult[];
  /** 记录集 */
  records: IRecord[];
  /** 复盘集 */
  reviews: IGoalReview[];
  /** 动机与可行性分析 */
  analysis: {
    /** 动机描述 */
    motive: string;
    /** 可行性分析 */
    feasibility: string;
  };
  /** 生命周期 */
  lifecycle: {
    createdAt: DateTime;
    updatedAt: DateTime;
    status: "active" | "completed" | "paused" | "archived";
  };
  /** 分析数据 */
  analytics: {
    /** 总体进度百分比 */
    overallProgress: number;
    /** 加权进度百分比 */
    weightedProgress: number;
    /** 完成的关键结果数量 */
    completedKeyResults: number;
    /** 总关键结果数量 */
    totalKeyResults: number;
  };
  /** 版本号 */
  version: number;
}
```

### 业务流程

### 1. 目标创建

在创建成功前在渲染进程
1. 点击创建按钮后， new 一个属性为空的临时对象，并传给 goal dialog
2. goal dialog 中的表单数据与 对象属性（只读） 使用 computed 的 get、set 进行双向绑定
3. 点击添加 关键结果按钮时，new 一个属性为空的临时对象，并传给 keyResult dialog
4. 同样绑定 关键结果数据与表单
5. 点击保存关键结果时，调用 goal 的添加 keyResult 方法
6. 点击保存目标时，调用应用层服务来持久化存储和同步状态数据

### 2. 目标删除

1. 点击「删除按钮」并「弹窗确认」后，调用目标模块的

## 主进程

# 渲染进程



UI、数据转换、前端业务逻辑

应该有页面（views）和组件（components）  
目标管理页面、目标详情页、关键结果详情页、记录创建表单  
目标创建表单、目标卡片、关键结果创建表单、

goalDirs 中应该默认有 全部、已删除、已归档 三个文件夹，并且 全部 文件夹一直显示并显示在文件夹列表最上方 已删除 和 已归档 文件夹在有数据时显示并显示在最下方

## presentation

### review

#### 布局

上方 header 显示标题和按钮，并固定在顶部。  
中间 sections 显示图表和自我诊断表单。  

想到两种布局方案：  
让它（#goal-review 容器）最小占据 100 %，但当内容超出时，随内容增加大小。  
或者说（#goal-review 容器 就占据 100%），让内容区域被可滚动标签包裹，在固定大小内滚动，始终有背景

**问题：**  
1. 这个 goal-review 为什么只占据了 100% 页面高度，内容已经超过了它，导致下滑后的区域没有背景了  
因为 `height: 100%`  是继承父元素的高度，如果父元素（比如 `<body>` 或 `<html>` 或上级 div）没有设置明确的高度（height: 100% 或 height: xxx px/vh），那么它的高度是由内容撑开的（auto），但不会超出父元素的高度。  
此时这个配置无效。



#### 图表区

1. 使用 echarts 库绘制图表来展示用户的目标完成信息

我是不是可以使用 echarts 的图表来更多得展示 目标完成情况信息给用户，让用户更好地复盘

将时间分为：  
- 6:00 - 12:00 早晨
- 12:00 - 18:00 下午
- 18:00 - 24:00 晚上
- 24:00 - 6:00 凌晨

根据目标中的 record 数据中的时间来判断目标完成的时间段，并将其分类，统计出来，并绘制图表，帮助用户了解自己的高效率时间段

2. 表现用户目标完成进度和时间进度的图表

首先是目标完成进度的图表，背景颜色则由时间进度（百分比）来填充，当时间进度超过目标完成进度的值到 danger_threshold 时，则将背景颜色设置为 danger_color（红），当时间进度超过目标完成进度的值到 warning_threshold 时，则将背景颜色设置为 warning_color（黄），当时间进度超过目标完成进度的值时，则将背景颜色设置为 safe_color（绿）。  

可以使用甘特图，或者什么图比较好呢？  
两个条形图  

3. 每个关键结果的进度体现
条形图


### 数据持久化

