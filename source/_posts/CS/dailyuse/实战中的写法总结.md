---
title: å®æˆ˜ä¸­çš„å†™æ³•æ€»ç»“
categories:
  - null
description: æœ¬æ–‡ç« ç”¨æ¥è®°å½•ä¸€ä¸‹æˆ‘åœ¨å®Œæˆ DailyUse é¡¹ç›®è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›å¥½ç”¨çš„ä»£ç å†™æ³•ã€‚
date: 2025-07-08 09:58:58
tags:
---

### å¯¹è±¡çš„åˆ›å»ºç¼–è¾‘è¡¨å•

1. ç»™å¯¹è±¡å®ç° cloneï¼ˆå¤åˆ¶ä¸€ä¸ªå¯¹è±¡ï¼‰ å’Œ forCreateï¼ˆåˆ›å»ºä¸€ä¸ªåˆå§‹åŒ–äº†åŸºç¡€ä¿¡æ¯ï¼ˆuuidç­‰ï¼‰çš„å¯¹è±¡ï¼‰ æ–¹æ³•
2. ç»™è¡¨å•ä¼ å…¥ å¯¹è±¡ | nullï¼Œå†é€šè¿‡ watch ç›‘å¬å¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡ä¸º nullï¼Œåˆ™åˆ›å»ºä¸€ä¸ªåˆå§‹å¯¹è±¡ï¼Œå¦åˆ™å°± clone ä¸€ä¸ªå¯¹è±¡ã€‚
3. è¡¨å•ä¸æœ¬åœ°å¯¹è±¡åŒå‘ç»‘å®šï¼Œç¼–è¾‘æˆ–åˆ›å»ºæäº¤æ—¶ä¼ é€’æœ¬åœ°å¯¹è±¡

ä¿®æ”¹å½“å‰ GoalDialog ä½¿ç”¨ç±»ä¼¼ TemplateDialog çš„æ–¹å¼ï¼Œä¼ å…¥ç¼–è¾‘å¯¹è±¡çš„å®ä¾‹ï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰æˆ– nullï¼ˆåˆ›å»ºæ¨¡å¼ï¼‰ï¼Œwatch visible å’Œ ä¼ å…¥çš„å¯¹è±¡ï¼Œä½¿ç”¨å¯¹è±¡çš„ clone æˆ– forCreate æ–¹æ³•åˆå§‹åŒ–æœ¬åœ°å¯¹è±¡ï¼Œè¡¨å•ä¸æœ¬åœ°å¯¹è±¡åŒå‘ç»‘å®šï¼Œç¼–è¾‘æˆ–åˆ›å»ºæäº¤æ—¶ä¼ é€’æœ¬åœ°å¯¹è±¡

### å¯¹è±¡çš„æ•°æ®ç›¸å…³æ–¹æ³•

- `toDTO()`ï¼š å°†å¯¹è±¡å®ä¾‹è½¬ä¸ºå¯¹è±¡æ¥å£æ•°æ®
- `static fromDTO(dto: T)`ï¼š å°†å¯¹è±¡æ¥å£æ•°æ®è½¬ä¸ºå¯¹è±¡å®ä¾‹
- `clone()`ï¼š åˆ›å»ºå¯¹è±¡çš„å‰¯æœ¬
- `forCreate()`ï¼š åˆ›å»ºå¯¹è±¡å®ä¾‹ï¼Œç”¨äºåˆ›å»ºæ¨¡å¼
- `isxxx()`ï¼š åˆ¤æ–­å¯¹è±¡å®ä¾‹æ˜¯å¦ä¸ºxxxå¯¹è±¡å®ä¾‹
- `ensurexxx()`ï¼š ç¡®ä¿å¯¹è±¡å®ä¾‹ä¸ºxxxå¯¹è±¡å®ä¾‹
- `ensurexxxNeverNull()`ï¼š ç¡®ä¿å¯¹è±¡å®ä¾‹ä¸ºxxxå¯¹è±¡å®ä¾‹ï¼Œå¹¶ä¸”ä¸ä¸ºnull

å¯¹è±¡å±æ€§æœ‰äº›æ˜¯åˆ›å»ºæ˜¯ä¼ å…¥çš„ï¼Œæœ‰äº›æ˜¯å¯¹è±¡å†…éƒ¨åˆå§‹åŒ–çš„æ¯”å¦‚ç”Ÿå‘½å‘¨æœŸç­‰ï¼ˆä¸èƒ½åœ¨åˆ›å»ºæ—¶ä¼ å…¥ï¼Œuuid åœ¨forCreateä¸­ä¸éœ€è¦ä¼ å…¥ï¼‰ï¼Œæ‰€ä»¥ `cloneï¼ˆï¼‰` ç­‰ä»å·²æœ‰å¯¹è±¡åˆ›å»ºå¯¹è±¡å®ä¾‹æ—¶ï¼Œéœ€è¦é€šè¿‡constructor åˆ›å»ºå®ä¾‹åå†åˆ©ç”¨ setter æ–¹æ³•è®¾ç½®å†…éƒ¨å±æ€§ã€‚

### ç±»å‹æ–­å®šç›¸å…³è¯­æ³•ç³–å†™æ³•æ•´ç†

#### 1. å¯é€‰é“¾ï¼ˆOptional Chainingï¼‰`?.`

ç”¨äºå®‰å…¨åœ°è®¿é—®å¯¹è±¡çš„åµŒå¥—å±æ€§æˆ–æ–¹æ³•ï¼Œé¿å…å› ä¸­é—´å±æ€§ä¸º null/undefined è€ŒæŠ¥é”™ã€‚

```ts
const arr = systemGroup?.templates;
```
ç­‰ä»·äºï¼š
```ts
const arr = systemGroup ? systemGroup.templates : undefined;
```

#### 2. ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦ï¼ˆNullish Coalescingï¼‰`??`

ç”¨äºä¸º null æˆ– undefined çš„å€¼æä¾›é»˜è®¤å€¼ã€‚

```ts
const arr = systemGroup?.templates ?? [];
```
ç­‰ä»·äºï¼š
```ts
const arr = (systemGroup && systemGroup.templates) != null ? systemGroup.templates : [];
```

#### 3. éç©ºè¿ç®—ç¬¦ï¼ˆNon-null Assertionï¼‰`!`

ç”¨äºå‘Šè¯‰ TypeScript å¿½ç•¥ null æˆ– undefined çš„å€¼ã€‚

#### 3. å±•å¼€è¿ç®—ç¬¦ï¼ˆSpread Operatorï¼‰`...`

ç”¨äºæ•°ç»„æˆ–å¯¹è±¡çš„å±•å¼€ã€åˆå¹¶ã€‚

```ts
const allTemplates = [...(systemGroup?.templates ?? []), ...otherTemplates];
```

---

### å‡½æ•°çš„å‚æ•°

å‡½æ•°çš„å‚æ•°åº”è¯¥é‡‡ç”¨å¯¹è±¡å½¢å¼ï¼š  
- ä¸éœ€è¦è®°ä½å‚æ•°é¡ºåºï¼Œè°ƒç”¨æ—¶åªéœ€å†™æ˜å±æ€§åã€‚
- å¯é€‰å‚æ•°å¯ä»¥çœç•¥ï¼Œä¸ä¼šå› é¡ºåºé”™ä¹±å¯¼è‡´ bugã€‚
- ä»£ç æ›´æ˜“è¯»ã€æ˜“ç»´æŠ¤ï¼Œæ‰©å±•æ€§æ›´å¥½ã€‚

### ä¿®æ”¹å¯¹è±¡çš„è¡¨å•

ç»™è¡¨å•ä¼ å…¥ è¦ä¿®æ”¹çš„å¯¹è±¡ï¼ˆç¼–è¾‘ï¼‰ || nullï¼ˆåˆ›å»ºï¼‰ï¼Œç›´æ¥ä½¿ç”¨ forCreateï¼ˆç¼–è¾‘ï¼‰ æˆ–è€… cloneï¼ˆåˆ›å»ºï¼‰ æ–¹æ³•æ¥ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åè®©è¡¨å•ä¸è¿™ä¸ªå¯¹è±¡åŒå‘ç»‘å®šæ¥ä¿®æ”¹æˆ–åˆ›å»ºï¼ˆæ¯ä¸€ä¸ªå±æ€§åˆ©ç”¨ computed çš„ get set æ–¹æ³•æ¥å¤„ç†ï¼‰ï¼ŒæˆåŠŸåè°ƒç”¨ç›¸åº”æœåŠ¡å’Œä¼ å…¥å¯¹è±¡ã€‚

### Electron çš„è¿›ç¨‹é—´æ•°æ®ä¼ è¾“é‡åˆ°é—®é¢˜ï¼ˆæ— æ³•è¢«å…‹éš†ï¼‰

```
[AccountIpcClient] å‘é€è´¦å·æ³¨å†Œè¯·æ±‚ Proxy(Object)Â {username: '123', firstName: '12', lastName: '3', sex: 1}
accountIpcClient.ts:9 ğŸ“ [AccountIpcClient] åºåˆ—åŒ–åçš„æ³¨å†Œæ•°æ® {username: '123', firstName: '12', lastName: '3', sex: 1}
```
æ³¨æ„ vue ä¸­çš„å¯¹è±¡æ•°æ®å¾ˆæœ‰å¯èƒ½æ˜¯è¢« ä»£ç† çš„ï¼Œéœ€è¦è½¬ä¸ºæ™®é€šå¯¹è±¡ï¼ˆå¯ä»¥ä½¿ç”¨ JSON æ–¹æ³•ï¼‰  

### Ts åœ¨ç±»ä¸­ä½¿ç”¨ pinia çŠ¶æ€çš„å»¶è¿ŸåŠ è½½

ä½¿ç”¨ get æ–¹æ³•å»¶è¿Ÿè·å– pinia çŠ¶æ€ï¼Œå¦åˆ™ä¼šæŠ¥æœªåœ¨ pinia åˆå§‹åŒ–å‰å°±è®¿é—® pinia çŠ¶æ€çš„é”™ã€‚  
ts æ˜¯ç¼–è¯‘æ—¶çš„ï¼Œæ‰€ä»¥æ— æ³•åœ¨è¿è¡Œæ—¶æ£€æŸ¥ pinia çŠ¶æ€çš„è®¿é—®ã€‚  

```ts

private get store() {
  return useReminderStore();
}

```

### ç±»çš„æ‡’åŠ è½½

å»¶è¿Ÿè·å–ä¾èµ–ï¼Œé¿å…å› ä¸ºé™æ€ç¼–è¯‘æ—¶åŠ è½½æœªå‡†å¤‡å¥½çš„ä¾èµ–ã€‚

```ts
class p {
  private _goalStore: ReturnType<typeof useGoalStore> | null = null;

  /**
   * å»¶è¿Ÿè·å– goalStoreï¼Œç¡®ä¿ Pinia å·²ç»åˆå§‹åŒ–
   */
  private get goalStore() {
    if (!this._goalStore) {
      this._goalStore = useGoalStore();
    }
    return this._goalStore;
  }

  async addGoal(goal: IGoal): Promise<void> {
    try {
      await this.goalStore.addGoal(goal);
      console.log(`âœ… [StateRepo] æ·»åŠ ç›®æ ‡åˆ°çŠ¶æ€: ${goal.id}`);
    } catch (error) {
      console.error(`âŒ [StateRepo] æ·»åŠ ç›®æ ‡å¤±è´¥: ${goal.id}`, error);
      throw error;
    }
  }

  isAvailable(): boolean {
    try {
      // ç®€å•æ£€æŸ¥ store æ˜¯å¦å¯ç”¨
      return this.goalStore !== null && this.goalStore !== undefined;
    } catch (error) {
      console.error("âŒ [StateRepo] çŠ¶æ€ä»“åº“ä¸å¯ç”¨", error);
      return false;
    }
  }
}
```

### ç±»çš„å·¥å‚å‡½æ•°åˆ›å»ºå®ä¾‹(å¼‚æ­¥)+å•ä¾‹+ä¾èµ–æ³¨å…¥ï¼ˆåˆ‡æ¢ä¸åŒçš„åˆ›å»ºå·¥å‚ï¼‰

```ts
class AuthenticationLogoutService {
  private static instance: AuthenticationLogoutService;
  private authCredentialRepository: IAuthCredentialRepository;
  constructor(authCredentialRepository: IAuthCredentialRepository) {
    
    this.authCredentialRepository = authCredentialRepository;
  }
  static async createInstance(): Promise<AuthenticationLogoutService> {
    const authenticationContainer = await AuthenticationContainer.getInstance();
    const authCredentialRepository = authenticationContainer.getAuthCredentialRepository();
    return new AuthenticationLogoutService(authCredentialRepository);
  }
  static async getInstance(): Promise<AuthenticationLogoutService> {
    if (!AuthenticationLogoutService.instance) {
      AuthenticationLogoutService.instance = await this.createInstance();
    }
    return AuthenticationLogoutService.instance;
  }

  // ä½ çš„ logout æ–¹æ³•ç­‰...
}


const logoutService = await AuthenticationLogoutService.createInstance();
```

### é¢†åŸŸæœåŠ¡ç±»

é¢†åŸŸæœåŠ¡ç±»ï¼Œç”¨äºå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œå°è£…äº†é¢†åŸŸæ¨¡å‹ï¼Œå¹¶å®šä¹‰äº†é¢†åŸŸæ¨¡å‹ä¹‹é—´çš„å…³ç³»ã€‚  
é¢†åŸŸæœåŠ¡ç±»ä¸ç›´æ¥å¯¼å…¥åŸºç¡€è®¾æ–½å±‚ï¼ˆä»“åº“ï¼‰ï¼Œåº”è¯¥é€šè¿‡åº”ç”¨æœåŠ¡å±‚æ³¨å…¥ä»“åº“ã€‚  

```typescript

```



### å¯¹è±¡å±æ€§çš„è¡¨å•

Vue çš„å“åº”å¼ç³»ç»Ÿå¯¹ class å®ä¾‹çš„ getter/setter æ”¯æŒæœ‰é™ï¼Œç›´æ¥ç”¨ class å®ä¾‹å±æ€§åš v-modelï¼Œåªæœ‰åœ¨ class å†…éƒ¨ç”¨ reactive/ref åŒ…è£¹ï¼Œæˆ–è€…ç”¨ computed åŒ…è£…ï¼Œæ‰èƒ½ä¿è¯è§†å›¾å’Œæ•°æ®åŒæ­¥ã€‚ 

```ts
const enableMode = computed({
  get: () => props.templateGroup?.enableMode || 'group',
  set: (val) => {
    if (localTemplateGroup.value) {
      localTemplateGroup.value.enableMode = val;
    }
  }
});
```

### å¯¹è±¡ç±»å‹å˜åŒ–

TS ä¸­çš„å¯¹è±¡è²Œä¼¼ç±»å‹ä¼šè«åå…¶å¦™çš„å˜åŒ–ï¼Œå¯¼è‡´æŠ¥ç±»å‹çš„åŒ¹é…çš„é”™è¯¯ï¼Œéœ€è¦ä½¿ç”¨ ensure å‡½æ•°æ¥ç¡®ä¿ç±»å‹

```ts

<!-- TemplateDialog -->
      <template-dialog
        :model-value="templateDialog.show"
        :template="templateDialog.template" // è¿™é‡Œä¼šæŠ¥é”™ï¼Œè¦æ”¹ä¸ºä¸‹é¢çš„å‚æ•°
        // ReminderTemplate.ensureReminderTemplate(templateDialog.template)
        @update:modelValue="templateDialog.show = $event"
        @submit="handleTemplateDialogSubmit"
        @create-template="handleCreateReminderTemplate"
        @update-template="handleUpdateReminderTemplate"
      />

const templateDialog = ref({
  show: false,
  template: null as ReminderTemplate | null
});

```

## DDD å®è·µç›¸å…³

### èšåˆæ ¹å†…ä¸šåŠ¡

åœ¨ æœåŠ¡æ–¹æ³•ä¸­å…ˆè·å–å¯¹è±¡ï¼Œå‚æ•°ç­‰ï¼Œå¹¶ç¡®ä¿æ­£å¸¸ï¼Œå†…éƒ¨æ–¹æ³•åˆ™åˆ©ç”¨éªŒè¯çš„æ•°æ®æ¥æ“ä½œï¼Œç¡®ä¿å†…éƒ¨ä¸ä¼šå‘ç”Ÿé”™è¯¯  

```ts
/**
  * æ·»åŠ è®°å½•
  */
addRecord(record: Record): void {
  const { keyResultUuid } = record;
  const keyResult = this._keyResults.find((kr) => kr.uuid === keyResultUuid);
  if (keyResult) {
    this.increaseKeyResultProgressByKR(keyResult, record.value);
    this._records.push(record);
    this._lifecycle.updatedAt = new Date();
    this._version++;
  }
}
```

### ä»“åº“å®ç°

å®ç° mapRowToKeyResultï¼ˆæ•°æ®åº“æ•°æ®è½¬æ¢æˆå¯¹è±¡ï¼‰å’Œ mapKeyResultToRowï¼ˆå¯¹è±¡è½¬æ¢æˆæ•°æ®åº“æ•°æ®ï¼‰

{
    "uuid": "3271617c-4f41-4a73-96c9-535081ba091d",
    "goalUuid": "05bd7999-f0fe-4746-a263-f3eab8d41e47",
    "title": "",
    "type": "custom",
    "reviewDate": "2025-07-27T15:01:44.646Z",
    "content": {
        "achievements": "2",
        "challenges": "",
        "learnings": "",
        "nextSteps": "3"
    },
    "snapshot": {
        "snapshotDate": "2025-07-27T15:01:44.646Z",
        "overallProgress": 0,
        "weightedProgress": 0,
        "completedKeyResults": 0,
        "totalKeyResults": 0,
        "keyResultsSnapshot": [
            {
                "uuid": "ca8fee17-6fe3-4dc8-b799-7ed8d70fb10e",
                "name": "22222",
                "progress": 0,
                "currentValue": 0,
                "targetValue": 10
            }
        ]
    },
    "rating": {
        "progressSatisfaction": 0,
        "executionEfficiency": 0,
        "goalReasonableness": 0
    },
    "lifecycle": {
        "createdAt": "2025-07-27T15:01:44.647Z",
        "updatedAt": "2025-07-27T15:01:44.647Z"
    }
}