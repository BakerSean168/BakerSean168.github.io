---
title: 浏览器渲染过程
categories:
  - HTML
description: 浏览器渲染过程
date: 2025-01-19 20:15:38
tags:
---

## 浏览器渲染过程

浏览器渲染页面主要包含以下 5 个步骤：

1. **解析 HTML 和 CSS**  
   将 HTML 解析为 DOM 树，CSS 解析为 CSSOM 树

2. **构建渲染树**  
   合并 DOM 和 CSSOM 形成渲染树

3. **布局（Layout）**  
   计算每个元素在屏幕上的确切位置和大小

4. **绘制（Paint）**  
   将渲染树转为屏幕上的实际像素

5. **合成（Composite）**  
   将各层合并显示到屏幕上

## 重排和重绘对比

| 对比项       | 重排（Reflow）                        | 重绘（Repaint）        |
| ------------ | ------------------------------------- | ---------------------- |
| **定义**     | 重新计算元素的几何属性和位置          | 重新绘制元素的外观样式 |
| **别名**     | 回流（Layout）、Firefox 中称为 Reflow | -                      |
| **性能影响** | 计算密集型，影响较大                  | 影响相对较小           |
| **关系**     | 重排一定会导致重绘                    | 重绘不一定导致重排     |

## 重排（Reflow）

### 定义

当 DOM 的变化影响了元素的几何属性（如位置、尺寸等）时，浏览器需要重新计算元素的几何属性，将其安放在界面中的正确位置。

### 触发条件

- 页面首次渲染（不可避免）
- 添加或删除可见的 DOM 元素
- 元素位置尺寸发生变化（包括外边距、内边距、边框大小、高度和宽度等）
- 元素内容变化（文字数量、图片大小等）
- 改变字体大小
- 改变浏览器窗口大小（resize 事件）
- 激活 CSS 伪类（如 `:hover`）
- 设置 style 属性的值
- 查询某些属性或调用某些方法（如 `offsetWidth`、`scrollTop` 等）

## 重绘（Repaint）

### 定义

当元素的外观样式发生改变但不影响布局时（如颜色、背景色等），浏览器会重新绘制受影响的部分。

### 触发条件

- 颜色的改变
- 文本方向的改变
- 阴影的改变
- `visibility` 样式的改变
- `outline` 样式的改变
- `background-color` 的改变

## 性能优化建议

1. **减少重排**

   - 批量修改 DOM
   - 使用 `transform` 代替改变位置
   - 避免频繁查询布局属性

2. **减少重绘**
   - 合并样式修改
   - 使用 CSS3 硬件加速
   - 避免复杂的 CSS 选择器
